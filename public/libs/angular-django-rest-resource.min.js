"use strict";angular.module("djangoRESTResources",["ng"]).factory("djResource",["$http","$parse",function(e,r){function t(e){return a(e,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function a(e,r){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,r?"%20":"+")}function n(e,r){this.template=e+="#",this.defaults=r||{},this.urlParams={}}function s(r,t,a){function p(e,r){var a={};return r=c({},t,r),i(r,function(r,t){h(r)&&(r=r()),a[t]=r.charAt&&"@"==r.charAt(0)?d(e,r.substr(1)):r}),a}function f(e){l(e||{},this)}var m=new n(r);return a=c({},u,a),i(a,function(r,t){r.method=angular.uppercase(r.method);var a="POST"==r.method||"PUT"==r.method||"PATCH"==r.method;f[t]=function(t,n,s,u){function d(){E.$resolved=!0}var g,v,w={},$=o,P=null;switch(arguments.length){case 4:P=u,$=s;case 3:case 2:if(!h(n)){w=t,g=n,$=s;break}if(h(t)){$=t,P=n;break}$=n,P=s;case 1:h(t)?$=t:a?g=t:w=t;break;case 0:break;default:throw"Expected between 0-4 arguments [params, data, success, error], got "+arguments.length+" arguments."}var v,E=this instanceof f?this:r.isArray?[]:new f(g),_={};return i(r,function(e,t){if("method"==t&&r.hasOwnProperty("method_if_field_has_value")){var a=r.method_if_field_has_value[0],n=r.method_if_field_has_value[1];_.method=g.hasOwnProperty(a)&&null!==g[a]?n:r.method}else"params"!=t&&"isArray"!=t&&(_[t]=l(e))}),_.data=g,m.setUrlParams(_,c({},p(g,r.params||{}),w),r.url),v=e(_),E.$resolved=!1,v.then(d,d),E.$then=v.then(function(t){var a=t.data,n=E.$then,s=E.$resolved,u=!1;if(a)if(r.isArray)if(E.length=0,a.hasOwnProperty("count")&&a.hasOwnProperty("results")){u=!0;var c=function h(r){if(null!==r.next){var a=l(_);a.params={},a.url=r.next,e(a).success(function(e){h(e)}).error(P)}i(r.results,function(e){E.push(new f(e))}),null==r.next&&($||o)(E,t.headers)};c(a)}else i(a,function(e){E.push(new f(e))});else l(a,E),E.$then=n,E.$resolved=s,E.$promise=v;return u||($||o)(E,t.headers),t.resource=E,t},P).then,E},f.prototype["$"+t]=function(e,r,n){var s,u=p(this),i=o;switch(arguments.length){case 3:u=e,i=r,s=n;break;case 2:case 1:h(e)?(i=e,s=r):(u=e,i=r||o);case 0:break;default:throw"Expected between 1-3 arguments [params, success, error], got "+arguments.length+" arguments."}var c=a?this:void 0;return f[t].call(this,u,c,i,s)}}),f.bind=function(e){return s(r,c({},t,e),a)},f}var u={get:{method:"GET"},save:{method:"POST",method_if_field_has_value:["id","PUT"]},update:{method:"PUT"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"}},o=angular.noop,i=angular.forEach,c=angular.extend,l=angular.copy,h=angular.isFunction,d=function(e,t){return r(t)(e)};return n.prototype={setUrlParams:function(e,r,a){var n,s,u=this,o=a||u.template,c=u.urlParams={};i(o.split(/\W/),function(e){!new RegExp("^\\d+$").test(e)&&e&&new RegExp("(^|[^\\\\]):"+e+"(\\W|$)").test(o)&&(c[e]=!0)}),o=o.replace(/\\:/g,":"),r=r||{},i(u.urlParams,function(e,a){n=r.hasOwnProperty(a)?r[a]:u.defaults[a],angular.isDefined(n)&&null!==n?(s=t(n),o=o.replace(new RegExp(":"+a+"(\\W|$)","g"),s+"$1")):o=o.replace(new RegExp("(/?):"+a+"(\\W|$)","g"),function(e,r,t){return"/"==t.charAt(0)?t:r+t})}),e.url=o.replace(/#$/,""),i(r,function(r,t){u.urlParams[t]||(e.params=e.params||{},e.params[t]=r)})}},s}]);